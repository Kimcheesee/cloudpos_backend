/**
 * @license MIT
 * @module @whoj/utils-vue@1.8.0
 * @copyright (c) 2023 Jonson B.
 */
import { watch } from 'vue-demi';
import { isClient, isString, noop } from '@whoj/utils-core';
import { unrefElement } from './unrefOfEl.mjs';
import { tryOnScopeDispose } from './tryOnScopeDispose.mjs';
const defaultWindow = /* @__PURE__ */ isClient() ? window : void 0;
const defaultDocument = /* @__PURE__ */ isClient() ? window.document : void 0;
function listenEvent(...args) {
  let target;
  let events;
  let listeners;
  let options;
  if (isString(args[0]) || Array.isArray(args[0])) {
    [events, listeners, options] = args;
    target = defaultWindow;
  } else {
    [target, events, listeners, options] = args;
  }
  if (!target) {
    return noop;
  }
  if (!Array.isArray(events)) {
    events = [events];
  }
  if (!Array.isArray(listeners)) {
    listeners = [listeners];
  }
  const cleanups = [];
  const cleanup = () => {
    cleanups.forEach((fn) => fn());
    cleanups.length = 0;
  };
  const register = (el, event, listener) => {
    el.addEventListener(event, listener, options);
    return () => el.removeEventListener(event, listener, options);
  };
  const stopWatch = watch(
    () => unrefElement(target),
    (el) => {
      cleanup();
      if (!el) {
        return;
      }
      cleanups.push(
        ...events.flatMap((event) => {
          return listeners.map((listener) => register(el, event, listener));
        })
      );
    },
    { immediate: true, flush: "post" }
  );
  const stop = () => {
    stopWatch();
    cleanup();
  };
  tryOnScopeDispose(stop);
  return stop;
}
export { defaultDocument, listenEvent };
//# sourceMappingURL=listenEvent.mjs.map

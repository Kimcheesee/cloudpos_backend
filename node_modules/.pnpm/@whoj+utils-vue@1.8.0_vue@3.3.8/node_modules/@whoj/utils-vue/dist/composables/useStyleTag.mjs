/**
 * @license MIT
 * @module @whoj/utils-vue@1.8.0
 * @copyright (c) 2023 Jonson B.
 */
import { ref, readonly, watch } from 'vue-demi';
import { tryOnMounted } from './tryOnMounted.mjs';
import { tryOnScopeDispose } from './tryOnScopeDispose.mjs';
import { defaultDocument } from './listenEvent.mjs';
let _id = 0;
function useStyleTag(css, options = {}) {
  const isLoaded = ref(false);
  const {
    document = defaultDocument,
    immediate = true,
    manual = false,
    id = `whoj.utils-vue_style_tag_${++_id}`
  } = options;
  const cssRef = ref(css);
  let stop = () => {
  };
  const load = () => {
    if (!document) {
      return;
    }
    const el = document.getElementById(id) || document.createElement("style");
    if (!el.isConnected) {
      el.type = "text/css";
      el.id = id;
      if (options.media) {
        el.media = options.media;
      }
      document.head.appendChild(el);
    }
    if (isLoaded.value) {
      return;
    }
    stop = watch(
      cssRef,
      (value) => {
        el.textContent = value;
      },
      { immediate: true }
    );
    isLoaded.value = true;
  };
  const unload = () => {
    if (!document || !isLoaded.value) {
      return;
    }
    stop();
    document.head.removeChild(document.getElementById(id));
    isLoaded.value = false;
  };
  if (immediate && !manual) {
    tryOnMounted(load);
  }
  if (!manual) {
    tryOnScopeDispose(unload);
  }
  return {
    id,
    css: cssRef,
    unload,
    load,
    isLoaded: readonly(isLoaded)
  };
}
export { useStyleTag };
//# sourceMappingURL=useStyleTag.mjs.map
